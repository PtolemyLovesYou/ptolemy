mutation CreateUserApiKey($name: String!, $userId: Uuid!, $durationDays: Int) {
  user(userId: $userId) {
    createUserApiKey(name: $name, durationDays: $durationDays) {
      apiKey {
        apiKey
      }
      ...Result
    }
  }
}

mutation CreateUser($userId: Uuid!, $username: String!, $password: String!, $isAdmin: Boolean!, $displayName: String) {
  user(userId: $userId) {
    create(
      userData: {username: $username, password: $password, isSysadmin: false, isAdmin: $isAdmin, displayName: $displayName}
    ) {
      ...Result
      user {
        ...ReturnsUser
      }
    }
  }
}

mutation DeleteUserApiKey($apiKeyId: Uuid!, $userId: Uuid!) {
  user(userId: $userId) {
    deleteUserApiKey(apiKeyId: $apiKeyId) {
      ...Result
    }
  }
}

mutation DeleteUser($Id: Uuid!, $userId: Uuid!) {
  user(userId: $userId) {
    delete(id: $Id) {
      ...Result
    }
  }
}

mutation AddUserToWorkspace($userId: Uuid!, $targetUserId: Uuid!, $workspaceId: Uuid!, $role: WorkspaceRoleEnum!) {
  workspace(userId: $userId) {
    addUser(
      workspaceUser: {userId: $targetUserId, workspaceId: $workspaceId, role: $role}
    ) {
      ...Result
    }
  }
}

mutation ChangeWorkspaceUserRole($role: WorkspaceRoleEnum!, $targetUserId: Uuid!, $userId: Uuid!, $workspaceId: Uuid!) {
  workspace(userId: $userId) {
    changeWorkspaceUserRole(
      newRole: $role
      userId: $targetUserId
      workspaceId: $workspaceId
    ) {
      ...Result
    }
  }
}

mutation CreateServiceApiKey($name: String!, $permission: ApiKeyPermissionEnum!, $userId: Uuid!, $workspaceId: Uuid!, $durationDays: Int) {
  workspace(userId: $userId) {
    createServiceApiKey(
      name: $name
      permission: $permission
      workspaceId: $workspaceId
      durationDays: $durationDays
    ) {
      ...Result
      apiKey {
        apiKey
      }
    }
  }
}

mutation DeleteServiceApiKey($apiKeyId: Uuid!, $userId: Uuid!, $workspaceId: Uuid!) {
  workspace(userId: $userId) {
    deleteServiceApiKey(apiKeyId: $apiKeyId, workspaceId: $workspaceId) {
      ...Result
    }
  }
}

mutation CreateWorkspace($userId: Uuid!, $name: String!, $description: String, $adminUserId: Uuid!) {
  workspace(userId: $userId) {
    create(
      workspaceData: {name: $name, description: $description}
      adminUserId: $adminUserId
    ) {
      ...Result
      workspace {
        ...ReturnsWorkspace
      }
    }
  }
}

mutation RemoveUserFromWorkspace($targetUserId: Uuid!, $userId: Uuid!, $workspaceId: Uuid!) {
  workspace(userId: $userId) {
    removeUser(userId: $targetUserId, workspaceId: $workspaceId) {
      ...Result
    }
  }
}

mutation DeleteWorkspace($userId: Uuid!, $workspaceId: Uuid!) {
  workspace(userId: $userId) {
    delete(workspaceId: $workspaceId) {
      ...Result
    }
  }
}

mutation Login($username: String!, $password: String!) {
  auth(userData: {username: $username, password: $password}) {
    ...Result
    payload {
      token
      user {
        ...ReturnsUser
      }
    }
  }
}

fragment ReturnsUser on User {
  displayName
  id
  isAdmin
  isSysadmin
  status
  username
}

fragment Result on GQLResult {
  error {
    field
    message
  }
  success
}

fragment ReturnsWorkspace on Workspace {
  id
  name
  description
  archived
  createdAt
  updatedAt
}
